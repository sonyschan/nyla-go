<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Fixes Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #1a1a1a; 
            color: white; 
        }
        .test-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333; 
            border-radius: 8px; 
        }
        .test-button { 
            background: #FF6B35; 
            color: white; 
            border: none; 
            padding: 10px 15px; 
            margin: 5px; 
            border-radius: 4px; 
            cursor: pointer; 
        }
        .test-result { 
            margin: 10px 0; 
            padding: 10px; 
            background: #2a2a2a; 
            border-radius: 4px; 
        }
        input, select {
            padding: 8px;
            margin: 5px;
            background: #333;
            color: white;
            border: 1px solid #555;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Extension Fixes Test</h1>
    
    <div class="test-section">
        <h2>1. Username Sync Test</h2>
        <p>Test that username changes sync between Receive tab and Settings</p>
        
        <div>
            <label>Simulate Receive Tab Username:</label>
            <input type="text" id="receiveUsernameTest" placeholder="@username" />
        </div>
        
        <div>
            <label>Simulate Settings Username:</label>
            <input type="text" id="settingsUsernameTest" placeholder="@username" />
        </div>
        
        <button onclick="testUsernameSync()" class="test-button">Test Username Sync</button>
        <div id="usernameSyncResult" class="test-result">Test username sync functionality...</div>
    </div>
    
    <div class="test-section">
        <h2>2. Menu Item i18n Test</h2>
        <p>Test that menu items are properly translated</p>
        
        <div>
            <label>Language:</label>
            <select id="languageTest">
                <option value="en">English</option>
                <option value="zh">中文 (Chinese)</option>
            </select>
        </div>
        
        <button onclick="testMenuI18n()" class="test-button">Test Menu Translation</button>
        
        <div id="menuItems">
            <h4>Menu Items:</h4>
            <div id="menuItemsResult" class="test-result">Menu items will appear here...</div>
        </div>
        
        <div id="menuI18nResult" class="test-result">Test menu i18n functionality...</div>
    </div>

    <script src="nylago-data.js"></script>
    <script src="extension-i18n.js"></script>
    <script>
        let extensionI18n;
        
        // Initialize test
        document.addEventListener('DOMContentLoaded', function() {
            if (window.ExtensionI18n) {
                extensionI18n = new window.ExtensionI18n();
                console.log('Extension i18n initialized for testing');
            }
        });
        
        function testUsernameSync() {
            const receiveInput = document.getElementById('receiveUsernameTest');
            const settingsInput = document.getElementById('settingsUsernameTest');
            const resultDiv = document.getElementById('usernameSyncResult');
            
            // Simulate the sync behavior
            receiveInput.addEventListener('input', function() {
                // This simulates the fixed sync behavior
                const username = receiveInput.value.trim();
                localStorage.setItem('nylaGoUsername', username);
                settingsInput.value = username;
                
                resultDiv.innerHTML = `
                    ✅ <strong>Username Sync Test Passed!</strong><br>
                    Receive Tab: "${receiveInput.value}"<br>
                    Settings: "${settingsInput.value}"<br>
                    LocalStorage: "${localStorage.getItem('nylaGoUsername') || 'not set'}"<br>
                    <em>All three should match when typing in Receive field</em>
                `;
            });
            
            settingsInput.addEventListener('input', function() {
                // This simulates the settings sync behavior
                const username = settingsInput.value.trim();
                localStorage.setItem('nylaGoUsername', username);
                receiveInput.value = username;
                
                resultDiv.innerHTML = `
                    ✅ <strong>Settings Sync Test Passed!</strong><br>
                    Settings: "${settingsInput.value}"<br>
                    Receive Tab: "${receiveInput.value}"<br>
                    LocalStorage: "${localStorage.getItem('nylaGoUsername') || 'not set'}"<br>
                    <em>All three should match when typing in Settings field</em>
                `;
            });
            
            resultDiv.innerHTML = `
                ✅ <strong>Sync Listeners Added!</strong><br>
                Try typing in either field to test the sync behavior.<br>
                Both fields and localStorage should stay in sync.
            `;
        }
        
        function testMenuI18n() {
            const languageSelect = document.getElementById('languageTest');
            const menuItemsResult = document.getElementById('menuItemsResult');
            const resultDiv = document.getElementById('menuI18nResult');
            
            if (!extensionI18n || !window.NYLA_COMMUNITY_DATA) {
                resultDiv.innerHTML = '❌ Required components not loaded';
                return;
            }
            
            // Change language
            const selectedLang = languageSelect.value;
            extensionI18n.setLanguage(selectedLang);
            
            // Generate menu items with translations
            let menuHtml = '';
            window.NYLA_COMMUNITY_DATA.menuItems.forEach(item => {
                const translatedName = item.i18nKey 
                    ? extensionI18n.t(item.i18nKey) 
                    : item.name;
                    
                menuHtml += `
                    <div style="padding: 8px; margin: 4px; background: #333; border-radius: 4px;">
                        ${item.icon} <strong>${translatedName}</strong>
                        <small>(key: ${item.i18nKey || 'none'})</small>
                    </div>
                `;
            });
            
            menuItemsResult.innerHTML = menuHtml;
            
            resultDiv.innerHTML = `
                ✅ <strong>Menu i18n Test Complete!</strong><br>
                Language: <strong>${selectedLang}</strong><br>
                Menu items are translated using i18n keys.<br>
                <em>Try changing the language and clicking the button again.</em>
            `;
        }
        
        // Auto-test menu i18n on page load
        setTimeout(() => {
            if (extensionI18n) {
                testMenuI18n();
            }
        }, 500);
    </script>
</body>
</html>